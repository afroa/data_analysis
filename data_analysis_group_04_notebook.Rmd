---
title: "data_analysis_group_04_notebook"
output: html_document
date: '2022-04-15'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

Deliverable 2 (week 11) - 10 percent: 
Turn in, via GitHub, an updated draft data notebook (.RMD) that :
Loads and cleans the core data set to prepare for analysis. 
Shows basic exploratory analysis to demonstrate an understanding of the dataset, including the number of rows and columns, any obvious limitations or flaws and any reasons why it might not be able to answer the questions you've posed last week.

Here are the things we set out to do in cleaning this data:
- Clean county names to match census 
- Get rid of date created column
- Try to get rid of MOE row

We first tried to clean the data in R. We were successful in filtering by income to remove the MOE data that we did not need. We wanted to flip the rows and columns of the original dataframe so it would be easier to map onto census data later on. But we ran into *significant* hurdles trying to flip them. When we used the t() function -- which we Googled -- it saved it as a matrix instead of a dataframe. When we changed it to a dataframe, it looked like the data was consistent but when we tried to export it to Open Refine to continue cleaning it got very messy (it got rid of all of the county names each time). After two hours, we decided to clean up this data manually in excel. The small scale of the data allowed us to do this because there were so few rows and columns, but in the future we know this is not a sustainable way of cleaning data. (Do you know what caused this to happen? Or ways that we could've gone about this differently?) In excel, we standardized the county names to align with the census data, we transposed the rows and columns and added a "name" column that we can use in future analysis and got rid of excess rows, such as the MOE and "income" rows, and date created column. 

There are 11 columns and 25 rows in our cleaned data set, one row for each Maryland jurisdiction. This data is limited because it only has median income, so we will have to join it to other demographic and census data. We will be using the census data on home ownership. At this point, we do not have any housing data included in our analysis data, so for our next milestone we will work on joining datasets with the one we just cleaned. 

*We have left our effort to clean in R below, but ended up cleaning the data outside of R using excel. We wanted to leave it to show we tried, and so you could see where we went wrong/give any tips for the future. :D *

```{r}

library(tidycensus)
library(tidyverse)
library(janitor)
library(dplyr)

#Reading the data into a new dataframe

md_median_household_income <- read.csv("data/md_median_household_income.csv")

# Cleaning the data

clean_rows <- md_median_household_income %>%
  filter(Data == "Income") %>%
  clean_names() %>%
  t() 

flipped_rows <- as.data.frame(clean_rows)
  
flipped_rows %>%
  rename(flipped_rows, V1 = "2010")

#  mutate(COUNTY = toupper(str_remove_all(COUNTY,", West Virginia|County"))) %>%
#  mutate(COUNTY = str_trim(COUNTY,side="both"))

```

```{r}

median_hh_income_cleaned_data <- read_csv("data/final_final.csv")

```

***Question 1***

# 1. What percentage of people in Prince George's County rent their homes? What percentage own their homes?

The percentage of people in Prince George's County that rent their homes is roughly 36.8%. The percentage that own their homes is roughly 63.2. One question that we have about these statistics is of those PG County homeowners, how many buy homes to place on the rental-market, and how many buy homes to live in themselves? In the future, we hope to use these percentages to understand why it is cheaper to own a home in PG County than it is to rent, which was a finding from many of the articles on PG County housing that we researched before starting our data exploration for this project. 

# 2. How does Prince George's County compare to other counties for both renters and home owners?

When compared to every other county in the state of Maryland, Prince George's County has the third lowest rate of home ownership. The county also has the third highest rate of renter occupied domiciles. Based on these statistics, we wonder what demographics rent in Prince George's County and what demographics buy in Prince George's County? In the future, we would like to explore racial and socioeconomic demographics and see if these relate at all to home ownership/rental rates. 

```{r echo=TRUE}
acs2019 <- load_variables(2019, "acs5",cache = TRUE)

owner_occupied_md <- get_acs(
  geography = "county",
  variables = c(owneroccupied = "B25008_002"),
  state = "MD",
  year = 2019
)

renter_occupied_md <- get_acs(
  geography = "county",
  variables = c(renter_occupied = "B25008_003"),
  state = "MD",
  year = 2019
)

all_housing_md <- get_acs(
  geography = "county",
  variables = c(total_housing = "B25008_001"),
  state = "MD",
  year = 2019
)

all_combined_housing <- all_housing_md %>% inner_join(renter_occupied_md, by=c("GEOID", "NAME")) %>%
  rename(total_housing_2019=estimate.x, total_renter_2019=estimate.y) %>%
  select(NAME, total_housing_2019, total_renter_2019)

final_combined_housing <- all_combined_housing %>% inner_join(owner_occupied_md, by=c("NAME")) %>%
  rename(total_owner_2019=estimate) %>%
  select(NAME, total_housing_2019, total_renter_2019, total_owner_2019) %>%
  mutate(percent_renter_2019 = (total_renter_2019/total_housing_2019)*100) %>%
  mutate(percent_owner_2019 = (total_owner_2019/total_housing_2019)*100)

final_combined_housing %>%
  arrange(desc(percent_owner_2019))

final_combined_housing %>%
  arrange(desc(percent_renter_2019))

```

# 3. How does Prince George's County's percentage of home ownership and renters in 2019 compare to the county's percentages in 2010?

Since the 2010 census, PG County saw a 17.8% increase in renting, and a 1.2% increase in home ownership. There was a roughly 6.7% increase in housing. We are wondering what qualifies for "housing" in terms of the census definition. Of that across-the-board increase, was there an increase in availability of Affordable Housing in the last 10 years? We would be interested in looking at whether housing subsidy programs that the county has implemented has contributed to the increase in renters. We would also like to determine how median home prices changed over the last 10 years in Prince George's County? How did the median rent change over the last 10 years? How have these changes affected migration patterns in the state given that towns that were once hot spots because of cheaper rent/home prices have become gentrified and more expensive to live in, pushing lower income out? Based on this, we also wonder whether any major employers have arrived or left Prince George's County as their population fluctuates due to their migration. With the data we have so far, can we project how the COVID pandemic has affected renting and home ownership in the state and what would the projections/conclusions be?

```{r echo=TRUE}

acs2010 <- load_variables(2010, "acs5",cache = TRUE)

owner_occupied_md_2010 <- get_acs(
  geography = "county",
  variables = c(owneroccupied = "B25008_002"),
  state = "MD",
  year = 2010
)

renter_occupied_md_2010 <- get_acs(
  geography = "county",
  variables = c(renter_occupied = "B25008_003"),
  state = "MD",
  year = 2010
)

all_housing_md_2010 <- get_acs(
  geography = "county",
  variables = c(total_housing = "B25008_001"),
  state = "MD",
  year = 2010
)

decade_housing <- final_combined_housing %>% inner_join(renter_occupied_md_2010, by=c("NAME")) %>%
  rename(total_renter_2010=estimate)

combined_owners <- decade_housing %>% inner_join(owner_occupied_md_2010, by=c("NAME")) %>%
  rename(total_owner_2010=estimate)

decade_total_housing_combined <- combined_owners %>% inner_join(all_housing_md_2010, by=c("NAME")) %>%
  rename(total_housing_2010=estimate) %>%
  select(NAME, total_housing_2010, total_renter_2010, total_owner_2010, total_housing_2019, total_renter_2019, total_owner_2019) 

decade_pg_housing <- decade_total_housing_combined %>%
  filter(NAME == "Prince George's County, Maryland") %>%
  mutate(percent_change_owner = ((total_owner_2019/total_owner_2010)-1)*100) %>%
  mutate(percent_change_renter = ((total_renter_2019/total_renter_2010)-1)*100) %>%
  mutate(percent_change_housing = ((total_housing_2019/total_housing_2010)-1)*100)

```

# 4. Merging demographic data with the housing dataframe

```{r echo=TRUE}

acs2010 <- load_variables(2019, "acs5",cache = TRUE) %>%
  filter(name >= "B02001_002", name <= "B02001_010")

white_data <- get_acs(
  geography = "county",
  variables = c(race = "B02001_002"),
  state = "MD",
  year = 2019
)

black_data <- get_acs(
  geography = "county",
  variables = c(race = "B02001_003"),
  state = "MD",
  year = 2019
)

native_data <- get_acs(
  geography = "county",
  variables = c(race = "B02001_004"),
  state = "MD",
  year = 2019
)

asian_data <- get_acs(
  geography = "county",
  variables = c(race = "B02001_005"),
  state = "MD",
  year = 2019
)

pacific_islander_data <- get_acs(
  geography = "county",
  variables = c(race = "B02001_006"),
  state = "MD",
  year = 2019
)

one_other_race <- get_acs(
  geography = "county",
  variables = c(race = "B02001_007"),
  state = "MD",
  year = 2019
)

two_or_more_races <- get_acs(
  geography = "county",
  variables = c(race = "B02001_008"),
  state = "MD",
  year = 2019
)

two_races_including_some_other_race <- get_acs(
  geography = "county",
  variables = c(race = "B02001_009"),
  state = "MD",
  year = 2019
)

two_races_exluding_or_three_races <- get_acs(
  geography = "county",
  variables = c(race = "B02001_010"),
  state = "MD",
  year = 2019
)

combined_race_1 <- white_data %>%
  inner_join(black_data, by=c("GEOID", "NAME")) %>%
  rename(black_population=estimate.y, white_population=estimate.x) %>%
  select(GEOID, NAME, black_population, white_population)

combined_race_2 <- combined_race_1 %>%
  inner_join(native_data, by=c("GEOID", "NAME")) %>%
  rename(native_population=estimate) 

combined_race_3 <- combined_race_2 %>%
  inner_join(asian_data, by=c("GEOID", "NAME")) %>%
  rename(asian_population=estimate)

combined_race_4 <- combined_race_3 %>%
  inner_join(pacific_islander_data, by=c("GEOID", "NAME")) %>%
  rename(pacific_island_population=estimate)

combined_race_5 <- combined_race_4 %>%
  inner_join(one_other_race, by=c("GEOID", "NAME")) %>%
  rename(one_other_race=estimate)

combined_race_6 <- combined_race_5 %>%
  inner_join(two_or_more_races, by=c("GEOID", "NAME")) %>%
  rename(two_or_more_races=estimate)

combined_race_7 <- combined_race_6 %>%
  inner_join(two_races_including_some_other_race, by=c("GEOID", "NAME")) %>%
  rename(two_races_including_some_other_race=estimate)

final_racial_demographics <- combined_race_7 %>%
  inner_join(two_races_exluding_or_three_races, by=c("GEOID", "NAME")) %>%
  rename(two_races_exluding_or_three_races=estimate) %>%
  select(GEOID, NAME, black_population, white_population, native_population, asian_population, pacific_island_population, one_other_race, two_or_more_races, two_races_including_some_other_race)

combined_race_and_housing <- final_racial_demographics %>%
  inner_join(final_combined_housing, by=c("NAME"))

prince_georges_race <- combined_race_and_housing %>%
  filter(NAME == "Prince George's County, Maryland")

prince_georges_race_and_housing <- decade_pg_housing %>%
  inner_join(prince_georges_race, by=c("NAME")) %>%
  select(GEOID, NAME, black_population, white_population, native_population, asian_population, pacific_island_population, one_other_race, two_or_more_races, two_races_including_some_other_race, total_housing_2019.y, total_renter_2019.y, total_owner_2019.y, percent_change_owner, percent_change_renter, percent_change_housing)

white_data_homeownership <- get_acs(
  geography = "county",
  variables = c(race = "B25003A_002"),
  state = "MD",
  year = 2019)

black_data_homeownership <- get_acs(
  geography = "county",
  variables = c(race = "B25003B_002"),
  state = "MD",
  year = 2019)

americanindian_alaskannative_data_homeownership <- get_acs(
  geography = "county",
  variables = c(race = "B25003C_002"),
  state = "MD",
  year = 2019)

asian_data_homeownership <- get_acs(
  geography = "county",
  variables = c(race = "B25003D_002"),
  state = "MD",
  year = 2019)

nativehawaiian_aapi_data_homeownership <- get_acs(
  geography = "county",
  variables = c(race = "B25003E_002"),
  state = "MD",
  year = 2019)

someohterracealone_data_homeownership <- get_acs(
  geography = "county",
  variables = c(race = "B25003F_002"),
  state = "MD",
  year = 2019)

twootherraces_data_homeownership <- get_acs(
  geography = "county",
  variables = c(race = "B25003G_002"),
  state = "MD",
  year = 2019)

whitealonenothispanicorlatino_data_homeownership <- get_acs(
  geography = "county",
  variables = c(race = "B25003H_002"),
  state = "MD",
  year = 2019)

hispanicorlatino_data_homeownership <- get_acs(
  geography = "county",
  variables = c(race = "B25003I_002"),
  state = "MD",
  year = 2019)


```


```{r}

##Owner combined
owner_combined_race_1 <- white_data_homeownership %>%
  inner_join(black_data_homeownership, by=c("GEOID", "NAME")) %>%
  rename(owner_black_population=estimate.y, owner_white_population=estimate.x) %>%
  select(GEOID, NAME, owner_black_population, owner_white_population)

owner_combined_race_2 <- owner_combined_race_1 %>%
  inner_join(americanindian_alaskannative_data_homeownership, by=c("GEOID", "NAME")) %>%
  rename(owner_native_population=estimate) 

owner_combined_race_3 <- owner_combined_race_2 %>%
  inner_join(asian_data_homeownership, by=c("GEOID", "NAME")) %>%
  rename(owner_asian_population=estimate)

owner_combined_race_4 <- owner_combined_race_3 %>%
  inner_join(nativehawaiian_aapi_data_homeownership, by=c("GEOID", "NAME")) %>%
  rename(owner_pacific_island_population=estimate)

owner_combined_race_5 <- owner_combined_race_4 %>%
  inner_join(someohterracealone_data_homeownership, by=c("GEOID", "NAME")) %>%
  rename(owner_some_other_race=estimate)

owner_combined_race_6 <- owner_combined_race_5 %>%
  inner_join(twootherraces_data_homeownership, by=c("GEOID", "NAME")) %>%
  rename(owner_two_or_more_races=estimate)

owner_combined_race_7 <- owner_combined_race_6 %>%
  inner_join(whitealonenothispanicorlatino_data_homeownership, by=c("GEOID", "NAME")) %>%
  rename(owner_whitealonenothispanicorlatino_data_homeownership=estimate)

owner_combined_race_8 <- owner_combined_race_7 %>%
  inner_join(hispanicorlatino_data_homeownership, by=c("GEOID", "NAME")) %>%
  rename(hispanicorlatino_data_homeownership=estimate)
```

```{r}

##Home renters by race

white_data_rentership <- get_acs(
  geography = "county",
  variables = c(race = "B25003A_003"),
  state = "MD",
  year = 2019)

black_data_rentership <- get_acs(
  geography = "county",
  variables = c(race = "B25003B_003"),
  state = "MD",
  year = 2019)

americanindian_alaskannative_data_rentership <- get_acs(
  geography = "county",
  variables = c(race = "B25003C_003"),
  state = "MD",
  year = 2019)

asian_data_rentership <- get_acs(
  geography = "county",
  variables = c(race = "B25003D_003"),
  state = "MD",
  year = 2019)

nativehawaiian_aapi_data_rentership <- get_acs(
  geography = "county",
  variables = c(race = "B25003E_003"),
  state = "MD",
  year = 2019)

someohterracealone_data_rentership <- get_acs(
  geography = "county",
  variables = c(race = "B25003F_003"),
  state = "MD",
  year = 2019)

twootherraces_data_rentership <- get_acs(
  geography = "county",
  variables = c(race = "B25003G_003"),
  state = "MD",
  year = 2019)

whitealonenothispanicorlatino_data_rentership <- get_acs(
  geography = "county",
  variables = c(race = "B25003H_003"),
  state = "MD",
  year = 2019)

hispanicorlatino_data_rentership <- get_acs(
  geography = "county",
  variables = c(race = "B25003I_003"),
  state = "MD",
  year = 2019)

```

```{r}

#Combined ownership and race
final_owner_race_demographics <- owner_combined_race_8 %>%
  select(GEOID, NAME, owner_black_population, owner_white_population, owner_native_population, owner_asian_population, owner_pacific_island_population, owner_some_other_race, owner_two_or_more_races, owner_whitealonenothispanicorlatino_data_homeownership,hispanicorlatino_data_homeownership)

```


```{r}

renter_combined_race_1 <- white_data_rentership %>%
  inner_join(black_data_rentership, by=c("GEOID", "NAME")) %>%
  rename(renter_black_population=estimate.y, renter_white_population=estimate.x) %>%
  select(GEOID, NAME, renter_black_population, renter_white_population)

renter_combined_race_2 <- renter_combined_race_1 %>%
  inner_join(americanindian_alaskannative_data_rentership, by=c("GEOID", "NAME")) %>%
  rename(renter_native_population=estimate) 

renter_combined_race_3 <- renter_combined_race_2 %>%
  inner_join(asian_data_rentership, by=c("GEOID", "NAME")) %>%
  rename(renter_asian_population=estimate)

renter_combined_race_4 <- renter_combined_race_3 %>%
  inner_join(nativehawaiian_aapi_data_rentership, by=c("GEOID", "NAME")) %>%
  rename(renter_pacific_island_population=estimate)

renter_combined_race_5 <- renter_combined_race_4 %>%
  inner_join(someohterracealone_data_rentership, by=c("GEOID", "NAME")) %>%
  rename(renter_some_other_race=estimate)

renter_combined_race_6 <- renter_combined_race_5 %>%
  inner_join(twootherraces_data_rentership, by=c("GEOID", "NAME")) %>%
  rename(renter_two_or_more_races=estimate)

renter_combined_race_7 <- renter_combined_race_6 %>%
  inner_join(hispanicorlatino_data_rentership, by=c("GEOID", "NAME")) %>%
  rename(renter_hispanicorlatino_data=estimate)

renter_combined_race_8 <- renter_combined_race_7 %>%
  inner_join(whitealonenothispanicorlatino_data_rentership, by=c("GEOID", "NAME")) %>%
  rename(white_alone_rentership=estimate)

```

```{r}
#Combined ownership and race

final_renter_race_demographics <- renter_combined_race_8 %>%
  select(GEOID, NAME, renter_black_population, renter_white_population, renter_native_population, renter_asian_population, renter_pacific_island_population, renter_some_other_race, renter_two_or_more_races, renter_hispanicorlatino_data,renter_hispanicorlatino_data)

```

```{r}


renter_owner_race_combined <- final_renter_race_demographics %>%
  inner_join(final_owner_race_demographics, by=c("GEOID", "NAME"))

everything_combined <- combined_race_and_housing %>%
  inner_join(total_housing_race, by=c("GEOID", "NAME")) %>%
  select(-c(total_housing_2019.x, total_renter_2019.x, total_owner_2019.x))


```


# What demographic group owns the greatest share of housing in the state proportional to their population in each county? Is this what we expected?

**We expect white populations to own the most and Black populations to rent the most**

```{r}

# Finding Black renters

everything_combined %>%
  summarise(
    md_renters_black_state = sum(renter_black_population),
    md_black_pop = sum(black_population)) %>%
  mutate(percent_black_renters = (md_renters_black_state/md_black_pop)*100)

# Finding Black home owners

everything_combined %>%
  summarise(
    md_owners_black_state = sum(owner_black_population),
    md_black_pop = sum(black_population)) %>%
  mutate(percent_black_owners = (md_owners_black_state/md_black_pop)*100)

# Finding white renters

everything_combined %>%
  summarise(
    md_renters_white_state = sum(renter_white_population),
    md_white_pop = sum(white_population)) %>%
  mutate(percent_white_renters = (md_renters_white_state/md_white_pop)*100)

# Finding white homeowners

everything_combined %>%
  summarise(
    md_owners_white_state = sum(owner_white_population),
    md_white_pop = sum(white_population)) %>%
  mutate(percent_white_owners = (md_owners_white_state/md_white_pop)*100)


```




